# 项目总结 - 帕金森症状检测系统

## 📋 项目概述

这是一个基于STM32开发板的实时帕金森病症状检测系统，能够检测三种主要症状并通过BLE传输结果到移动设备。

## 🎯 核心功能

### 1. 症状检测
- ✅ **震颤检测** (3-5Hz): 使用FFT频率分析
- ✅ **运动障碍检测** (5-7Hz): 使用FFT频率分析
- ✅ **冻结步态检测**: 使用步态分析和方差检测

### 2. 数据采集
- ✅ 52Hz采样率（项目要求）
- ✅ 3秒数据窗口（156个样本）
- ✅ 加速度计和陀螺仪数据

### 3. 通信
- ✅ BLE无线传输
- ✅ 三个独立的BLE特征值
- ✅ 实时结果传输

## 📁 项目结构

```
embedded/
├── platformio.ini          # 项目配置（硬件+测试环境）
├── src/
│   ├── main.cpp           # 主程序（硬件运行）
│   ├── main_test.cpp      # 测试程序（电脑运行）
│   ├── SensorManager.*    # 传感器管理
│   ├── LSM6DSL.*          # 传感器驱动
│   ├── SymptomDetector.*  # 症状检测算法
│   ├── FFTProcessor.*      # FFT频率分析
│   ├── BLEManager.*       # BLE通信
│   └── mbed_compat.h      # 兼容层
└── 文档/
    ├── 项目要求详解.md
    ├── 代码阅读指南.md
    └── 代码阅读指南-详细版.md
```

## 🔧 技术栈

### 硬件
- **开发板**: ST B-L475E-IOT01A1
- **传感器**: LSM6DSL (加速度计+陀螺仪)
- **通信**: 集成BLE模块

### 软件
- **开发环境**: PlatformIO
- **框架**: Mbed OS
- **算法**: FFT (Cooley-Tukey算法)
- **通信协议**: BLE GATT

## 📊 关键参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 采样率 | 52Hz | 项目要求 |
| 数据窗口 | 3秒 (156样本) | 项目要求 |
| 震颤频率 | 3-5Hz | 医学特征 |
| 运动障碍频率 | 5-7Hz | 医学特征 |
| 加速度计量程 | ±2g | 项目要求 |
| 陀螺仪量程 | ±250dps | 适合运动检测 |
| I2C速度 | 400kHz | 快速数据传输 |

## 🚀 使用方法

### 电脑端测试

```bash
# 编译并运行测试程序
pio run -e native -t exec
```

### 硬件部署

```bash
# 编译硬件程序
pio run -e disco_l475vg_iot01a

# 上传到开发板
pio run -e disco_l475vg_iot01a -t upload

# 查看串口输出
pio device monitor
```

## 📖 文档说明

### 1. 项目要求详解.md
- 详细的项目需求说明
- 三种症状的医学背景
- 技术要求和评分标准

### 2. 代码阅读指南.md
- 代码阅读顺序建议
- 关键概念解释
- 常见问题解答

### 3. 代码阅读指南-详细版.md
- 更详细的代码解析
- 数据流程图
- 调试技巧
- 学习路径建议

## 🔍 核心算法

### 震颤/运动障碍检测
```
1. 数据预处理（去均值）
2. FFT频率分析
3. 计算目标频率范围能量
4. 与背景噪声对比
5. 判断是否超过阈值
```

### 冻结步态检测
```
1. 步态分析（检测步数）
2. 计算步频
3. 将数据分成三段
4. 计算前后段方差
5. 判断是否满足三个条件：
   - 之前有行走
   - 现在冻结
   - 突然停止
```

## 🎓 学习要点

### 必须理解的概念
1. **FFT原理**: 时域到频域的转换
2. **采样定理**: Nyquist定理
3. **BLE架构**: 服务、特征值、通知
4. **I2C通信**: 传感器数据读取
5. **数据窗口**: 滑动窗口分析

### 关键代码文件
1. `main.cpp`: 主程序流程
2. `SymptomDetector.cpp`: 检测算法核心
3. `FFTProcessor.cpp`: FFT实现
4. `SensorManager.cpp`: 数据采集
5. `BLEManager.cpp`: 通信实现

## ⚙️ 配置说明

### platformio.ini
- **两个环境**: `disco_l475vg_iot01a` (硬件) 和 `native` (测试)
- **构建标志**: 定义采样频率、窗口大小等参数
- **库依赖**: FFT库（如果需要）

### 关键宏定义
```cpp
SAMPLING_FREQUENCY=52      // 采样频率
DATA_WINDOW_SIZE=156       // 窗口大小
TREMOR_MIN_FREQ=3          // 震颤最小频率
TREMOR_MAX_FREQ=5          // 震颤最大频率
DYSKINESIA_MIN_FREQ=5      // 运动障碍最小频率
DYSKINESIA_MAX_FREQ=7      // 运动障碍最大频率
```

## 🐛 调试技巧

### 1. 添加调试输出
```cpp
printf("Tremor intensity: %.3f\r\n", intensity);
```

### 2. 可视化FFT结果
```cpp
for (int i = 0; i < 30; i++) {
    printf("Freq: %.2f Hz, Mag: %.2f\r\n", freq, mag);
}
```

### 3. 修改测试数据
在 `SensorManager.cpp` 中修改模拟数据来测试不同场景。

## 📝 注释说明

所有代码文件现在都包含：
- ✅ 详细的英文注释
- ✅ 函数说明（参数、返回值）
- ✅ 算法解释
- ✅ 关键步骤说明

## 🔄 数据流程

```
传感器硬件
  ↓
SensorManager (数据采集)
  ↓
数据缓冲区 (156个样本)
  ↓
SymptomDetector (症状检测)
  ├─> FFT频率分析
  ├─> 震颤检测
  ├─> 运动障碍检测
  └─> 冻结步态检测
  ↓
BLEManager (数据传输)
  ↓
移动设备
```

## ✅ 完成状态

- [x] 项目配置（PlatformIO）
- [x] 传感器驱动（LSM6DSL）
- [x] FFT频率分析
- [x] 震颤检测算法
- [x] 运动障碍检测算法
- [x] 冻结步态检测算法
- [x] BLE通信实现
- [x] 电脑端测试程序
- [x] 详细代码注释（英文）
- [x] 项目文档

## 🎯 下一步

1. **硬件测试**: 连接开发板，测试实际传感器数据
2. **参数优化**: 根据实际数据调整检测阈值
3. **移动APP**: 开发手机APP接收BLE数据
4. **性能优化**: 优化FFT计算速度
5. **算法改进**: 根据测试结果改进检测算法

## 📚 参考资料

- Mbed OS文档: https://os.mbed.com/docs/
- LSM6DSL数据表: ST官方文档
- BLE规范: Bluetooth SIG
- FFT算法: Cooley-Tukey算法

---

**项目状态**: ✅ 代码完成，注释完整，文档齐全

**最后更新**: 2024年

