# 使用指南

## 第一部分：上传到 GitHub

### 1. 初始化 Git（如果还没有）

**Windows (PowerShell 或 Git Bash):**
```bash
cd embedded
git init
```

### 2. 添加文件并提交

```bash
git add .
git commit -m "Initial commit: Parkinson symptom detection system"
```

### 3. 在 GitHub 创建仓库

1. 登录 GitHub
2. 点击右上角 `+` → `New repository`
3. 输入仓库名称（如 `parkinson-detector`）
4. 选择 Public 或 Private
5. 不要勾选 "Initialize with README"
6. 点击 `Create repository`

### 4. 连接并推送

```bash
# 添加远程仓库（替换 YOUR_USERNAME 和 REPO_NAME）
git remote add origin https://github.com/YOUR_USERNAME/REPO_NAME.git

# 推送代码
git branch -M main
git push -u origin main
```

---

## 第二部分：在有板子的电脑上运行

### 前提条件

- ✅ VSCode 已安装
- ✅ PlatformIO IDE 扩展已安装（在 VSCode 扩展市场搜索 "PlatformIO IDE" 安装）
- ✅ Python 3.11.7 已安装（Windows/Mac/Linux 都支持）
- ✅ ST B-L475E-IOT01A1 开发板
- ✅ **Windows 用户**：需要安装 Git（包含 Git Bash）或使用 PowerShell

### 步骤 1：从 GitHub 下载项目

**Windows (PowerShell 或 Git Bash):**
```bash
# 克隆项目（替换 YOUR_USERNAME 和 REPO_NAME）
git clone https://github.com/YOUR_USERNAME/REPO_NAME.git

# 进入项目目录
cd REPO_NAME
```

**注意**：Windows 用户可以使用 PowerShell、Git Bash 或 CMD，命令相同。

### 步骤 2：用 VSCode 打开项目

1. 打开 VSCode
2. `文件` → `打开文件夹...` → 选择项目文件夹
3. 等待 PlatformIO 自动初始化（首次需要下载工具链，可能需要几分钟）

### 步骤 3：连接开发板

1. 用 USB 线连接 ST B-L475E-IOT01A1 开发板到电脑
2. 确认开发板电源指示灯亮起

### 步骤 4：编译和上传

**方法 1：使用状态栏按钮（最简单）**

1. 查看 VSCode 底部状态栏，找到 PlatformIO 区域
2. 点击 **✓ (Build)** 按钮编译
3. 点击 **→ (Upload)** 按钮上传到开发板

**方法 2：使用快捷键**

- 编译：`Alt+Ctrl+B` (Windows/Linux) 或 `Cmd+Alt+B` (Mac)
- 上传：`Alt+Ctrl+U` (Windows/Linux) 或 `Cmd+Alt+U` (Mac)

**Windows 用户注意**：如果快捷键不工作，可能是快捷键冲突，使用状态栏按钮或命令面板即可。

**方法 3：使用命令面板**

1. 按 `Ctrl+Shift+P` (Mac: `Cmd+Shift+P`)
2. 输入 `PlatformIO: Upload`
3. 选择并执行

### 步骤 5：查看运行结果

1. 点击状态栏的 **🔌 (Serial Monitor)** 按钮
2. 或使用快捷键：`Alt+Ctrl+S` (Windows/Linux) 或 `Cmd+Alt+S` (Mac)

**预期输出：**
```
=== Parkinson's Disease Symptom Detection System ===
Sensor initialization successful (I2C address: 0xD6)
BLE initialization successful, device name: ParkinsonDetector
System initialization complete. Starting data acquisition...

=== Detection Results ===
Tremor: NO (Intensity: 0.00)
Dyskinesia: NO (Intensity: 0.00)
Freezing of Gait: NO (Intensity: 0.00)
```

程序每 3 秒输出一次检测结果。

---

## 常见问题

### 找不到开发板

- 检查 USB 连接
- **Windows**：检查设备管理器中是否有 "STM32 STLink" 或 "COM" 端口
- 运行 `pio device list` 查看设备（在 VSCode 终端或 PowerShell/Git Bash）
- 如果看到设备，在状态栏 PlatformIO 区域选择 `Upload to specific port`
- **Windows**：如果提示权限错误，可能需要以管理员身份运行 VSCode

### 上传失败

- **Windows**：确保 ST-Link 驱动已安装（通常 Windows 会自动安装，如果没有，从 ST 官网下载）
- **Windows**：检查设备管理器中是否有黄色感叹号（驱动问题）
- **Linux**：可能需要添加 USB 权限：`sudo usermod -a -G dialout $USER` 然后重新登录
- 尝试清理后重新编译：命令面板 → `PlatformIO: Clean`

### 编译错误

- 确保网络连接正常（首次编译需要下载工具链）
- 清理缓存：命令面板 → `PlatformIO: Clean`
- 重新编译

---

## 快速参考

**上传代码到 GitHub：**
```bash
git add .
git commit -m "Update"
git push
```

**在有板子的电脑上（Windows/Mac/Linux 通用）：**
1. `git clone` 下载项目
2. VSCode 打开项目
3. 连接开发板（USB）
4. 点击状态栏 **→ (Upload)** 按钮上传
5. 点击状态栏 **🔌 (Serial Monitor)** 按钮查看输出

## Windows 特别说明

✅ **完全支持 Windows**：硬件编译和上传在 Windows 上完全正常  
✅ **PlatformIO 支持**：PlatformIO 原生支持 Windows  
⚠️ **Native 测试环境**：`native` 测试环境在 Windows 上可能不可用（使用了 Unix 特定 API），但不影响硬件编译和运行  
✅ **使用硬件环境**：直接使用 `disco_l475vg_iot01a` 环境即可，无需测试环境
